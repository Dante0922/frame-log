# Agent Common Guide v2

모든 AI 에이전트(Claude Code, Codex, Gemini 등)가 공통으로 따를 기본 규칙.
이 문서는 프로젝트 공통 규칙만 다루며, 프로젝트별 세부사항은 별도 오버레이 문서에서 관리한다.

---

## 0. 적용 범위와 우선순위

- 적용 범위: 코드 작성, 수정, 테스트, 문서화, 커밋, PR, 브랜치, Worktree, 배포 전 점검
- 기본 우선순위: 사용자 직접 지시 > 프로젝트 오버레이 문서 > 이 공통 가이드
- 충돌 시 원칙: 더 구체적이고 최신인 지시를 우선 적용
- 충돌 해결 불가 시: 임의 판단하지 말고 사용자 확인 후 진행

---

## 1. 언어 규칙

- 코드(변수명, 함수명, 클래스명, 주석): 영어
- 커밋 메시지: 한국어
- PR 제목: 한국어
- PR 본문: 한국어
- 사용자와의 대화: 한국어

---

## 2. 프로젝트 오버레이 규칙

- 공통 문서는 기술 스택, 디렉토리, 실행 명령, 스코프 세부값을 강제하지 않는다
- 각 저장소는 `AGENTS_PROJECT.md`로 아래를 정의한다
- 기술 스택과 버전
- 디렉토리 구조와 파일 생성 기준
- 실행/테스트/빌드 명령
- 커밋 scope 목록
- 리뷰 체크리스트와 배포 기준

권장 구조:

```text
<repo>/
├── AGENTS.md                 # 공통 + 오버레이 진입 문서
├── AGENTS_PROJECT.md         # 프로젝트 전용 규칙
└── ...
```

---

## 3. 작업 시작 전 필수 확인

- 현재 브랜치 확인: `git branch --show-current`
- 변경사항 확인: `git status`
- 올바른 Worktree/디렉토리인지 확인
- 기존 코드 스타일/패턴 파악 후 동일하게 적용

금지:

- 작업 범위와 무관한 파일 수정
- 타 에이전트 전용 Worktree 수정
- 요청하지 않은 기능 추가

---

## 4. Git/브랜치/Worktree 규칙

- `main`, `develop` 직접 커밋/푸시 금지
- 작업 브랜치는 기능 단위로 분리
- 하나의 커밋은 하나의 논리적 변경 단위 유지
- 기본 실행 모드: 테스트 통과 시 에이전트가 `git commit`/`git push`/PR 생성까지 자율 수행 가능
- 승인 모드: 사용자가 명시하면 `git commit`/`git push`/PR 생성 전 승인 필수
- 히스토리 재작성 계열 명령은 항상 사용자 승인 필요 (`--force` push, `reset --hard`, 브랜치 삭제 등)
- `--force` push 금지(명시 요청 제외)
- Worktree 사용 시 본인 할당 경로에서만 작업

---

## 5. 커밋 규칙

형식:

```text
<type>(<scope>): <한국어 설명>
```

Type:

- `feat`: 기능 추가
- `fix`: 버그 수정
- `refactor`: 동작 변경 없는 구조 개선
- `style`: 포맷/스타일 변경
- `docs`: 문서 변경
- `test`: 테스트 변경
- `chore`: 설정/빌드/기타 유지보수
- `perf`: 성능 개선
- `ci`: CI/CD 변경
- `revert`: 커밋 롤백

작성 규칙:

- 한국어, 명사형 종결 권장
- 문장 끝 마침표 금지
- 의미 없는 메시지 금지(`WIP`, `tmp`, `asdf`)

예시:

```text
feat(front): 로그인 페이지 이메일 인증 추가
fix(back): JWT 토큰 만료 처리 수정
docs(root): API 엔드포인트 문서 보완
```
---

## 6. PR 규칙

- PR은 리뷰 가능한 크기로 분할
- 하나의 PR은 독립적으로 머지 가능한 상태 유지
- 기능 요약, 변경 배경, 테스트 결과를 본문에 명시
- UI 변경 시 스크린샷 첨부

권장 템플릿:

```markdown
## 변경 사항
- 무엇을 왜 변경했는지 요약

## 상세 내용
- 구현 세부 사항
- 기술적 결정 사항

## 테스트
- [ ] 단위 테스트 통과
- [ ] 수동 테스트 완료

## 스크린샷 (UI 변경 시)
```

---

## 7. 품질 게이트

- 변경 범위에 맞는 빌드/린트/테스트 실행
- 실행 불가 또는 미실행 항목은 이유를 명시
- 실패 상태 코드를 커밋하지 않는다

최소 확인 기준:

- 프론트: 타입 체크 + 빌드
- 백엔드: 컴파일 + 단위 테스트
- 공통: 영향 범위 수동 확인

---

## 8. 보안 규칙

- `.env`, 키, 토큰, 인증정보 커밋 금지
- 개인정보/민감정보 하드코딩 금지
- 외부 의존성 추가 시 사용자 승인 필요

---

## 9. 예외 처리 규칙

예외가 필요한 상황:

- 긴급 장애 대응
- 보안 취약점 즉시 차단
- 운영 중단 위험

예외 처리 절차:

- 사용자에게 예외 사유와 영향 공유
- 필요 시 사용자 승인 후 최소 변경만 반영
- PR 본문에 예외 근거 기록

---


## 10. 금지 사항 요약

- `main`/`develop` 직접 푸시
- 사용자 승인 없는 히스토리 재작성(`--force` push, `reset --hard`, 브랜치 삭제)
- 동작하지 않는 상태 커밋
- 타 에이전트 Worktree 수정
- 요청하지 않은 기능 추가
- 불필요한 대규모 리팩토링
